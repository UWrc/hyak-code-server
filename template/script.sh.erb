#!/usr/bin/env bash

# Create config file for code-server
cat > ${HOME}/.config/code-server/config.yaml <<END
bind-addr: 127.0.0.1:8080
auth: password
password: ${password}
cert: false
END

export PASSWORD=${password}

# Launch code-server Server:
echo "Starting code-server..."
echo "User: " ${HOME}
echo "Use password: " ${PASSWORD}
echo "Use password: " ${password}

apptainer exec --cleanenv --home ${HOME} ${CODESERVER_APPTAINER_IMAGE} \
    /app/code-server/bin/code-server \
    --bind-addr=${HOSTNAME}:${port} \
    --auth=password \
    --disable-telemetry \
    --disable-update-check
